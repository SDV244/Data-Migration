-- Create the Snowpipe for JDP_ASMNT_SVC_RLNG_3_MNTH_SG table
CREATE OR REPLACE PIPE JDP_ASMNT_SVC_RLNG_3_MNTH_SG_PIPE
AUTO_INGEST = TRUE
AS
COPY INTO JDP_ASMNT_SVC_RLNG_3_MNTH_SG
(   
    FSCL_YR_NB,
    FSCL_RLNG_03_MNTH_NB,
    SAMPL_ID,
    SRVY_ID,
    TYP_SL_DS,
    DLVRY_CHNL_DS,
    STS_DS,
    PRCSNG_DT,
    JD_PWR_SRVY_DT,
    ADVSR_NM,
    DLR_ZN_NM,
    DLR_GRP_NM,
    CSA_NM,
    ST_NM,
    MTRX_CD,
    DLR_CD,
    DLR_NM,
    INTERBRAND_DS,
    BIG_GRP_DS,
    CSI_DS,
    ROM_NM,
    FOM_NM,
    NSN_MDL_DS,
    S2_VHCL_DLVRD_DS,
    S3_SVC_TYP_DS,
    NPS1_RCMDTN_NB,
    NPS2_RTG_RSN_NB,
    SI0_HOW_SVC_APNTMT_WAS_SCHDLD_DS,
    SI1_A_EASE_OF_SVC_APNTMT_SCHDLG_NB,
    SI1_B_SPD_OF_VHCL_RCPT_NB,
    SI1_C_OVRL_SVC_INITIATION_PRCS_RTG_NB,
    SA1_A_FCS_ON_YOU_AND_YOUR_NEED_DS,
    SA1_B_PROVIDED_USEFUL_GDNC_ABOUT_YOUR_VHCL_DS,
    SA1_C_KPT_YOU_INFORMED_ABOUT_YOUR_VHCL_STS_DS,
    SA1_D_USD_TBLT_OR_MBL_DVC_DS,
    SA2_SVC_ADVSR_RVW_WRK_WITH_YOU_DS,
    SA3_A_SVC_ADVSR_FRIENDLINESS_NB,
    SA3_B_SVC_ADVSR_KNWLDG_NB,
    SA3_C_TRST_IN_THE_ATND_STF_NB,
    SA3_D_OVRL_SVC_ADVSR_RTG_NB,
    SF1_A_EASE_OF_ACS_AND_EXT_FRM_SVC_CTR_NB,
    SF1_B_SVC_CTR_CLEANLINESS_NB,
    SF1_C_COMFORT_AND_CRTSY_NB,
    SF1_D_OVRL_FCLTY_RTG_NB,
    VD1_SOMEONE_FRM_DLR_CNTCTD_YOU_WHN_VHCL_WAS_RDY_DS,
    VD2_VHCL_RDY_AS_PRMSE_DS,
    VD3_DTL_CST_ESTMT_PROVIDED_DS,
    VD4_FNL_AM_PD_DS,
    VD5_CST_EXPLTN_AFTR_SVC_CMPLTN_DS,
    VD6_A_TM_RQRD_TO_CMPLT_PPRWORK_AND_PKUP_DS,
    VD6_B_TM_FRM_ADVSR_ARVL_TO_FNL_DLVRY_DS,
    VD7_A_SPD_OF_DLVRY_PRCS_NB,
    VD7_C_FAIRNESS_OF_CHRG_NB,
    VD7_B_OVRL_DLVRY_PRCS_RTG_NB,
    SQ1_WRK_CMPLTD_RGHT_1ST_TM_DS,
    SQ1A_RSN_WRK_NOT_CMPLTD_1ST_TM_DS,
    SQ2_RSN_WRK_NOT_CMPLTD_1ST_TM_DS,
    SQ2_OTHR_SPCFY_DS,
    SQ3_VHCL_ADJSMT_RMN_THE_SM_DS,
    SQ4_A_TOTL_TM_RQRD_TO_CMPLT_SVC_NB,
    SQ4_B_VHCL_CLEANLINESS_AND_CNDTN_AT_DLVRY_NB,
    SQ4_C_OVRL_SVC_QLTY_RTG_NB,
    SE1_OVRL_SVC_EXPRNC_NB,
    SE2_SVC_EXPRNC_CMNT_DS,
    SE3_OVRL_OPIN_OF_NSN_AS_A_BRND_NB,
    STSFCN_INDX_NB,
    SVC_INITIATION_NB,
    DLR_STF_NB,
    FCLTS_NB,
    DLVRY_NB,
    QLTY_NB,
    HASHKEY,
    AUDIT_LOADED_DATE)
FROM (   
    SELECT
        $1::FLOAT AS FSCL_YR_NB,
        $2::FLOAT AS FSCL_RLNG_03_MNTH_NB,
        $3::VARCHAR(250) AS SAMPL_ID,
        $4::VARCHAR(250) AS SRVY_ID,
        $5::VARCHAR(250) AS TYP_SL_DS,
        $6::VARCHAR(250) AS DLVRY_CHNL_DS,
        $7::VARCHAR(250) AS STS_DS,
        $8::DATE AS PRCSNG_DT,
        $9::DATE AS JD_PWR_SRVY_DT,
        $10::VARCHAR(250) AS ADVSR_NM,
        $11::VARCHAR(250) AS DLR_ZN_NM,
        $12::VARCHAR(250) AS DLR_GRP_NM,
        $13::VARCHAR(250) AS CSA_NM,
        $14::VARCHAR(250) AS ST_NM,
        $15::VARCHAR(250) AS MTRX_CD,
        $16::VARCHAR(250) AS DLR_CD,
        $17::VARCHAR(250) AS DLR_NM,
        $18::VARCHAR(250) AS INTERBRAND_DS,
        $19::VARCHAR(250) AS BIG_GRP_DS,
        $20::VARCHAR(250) AS CSI_DS,
        $21::VARCHAR(250) AS ROM_NM,
        $22::VARCHAR(250) AS FOM_NM,
        $23::VARCHAR(250) AS NSN_MDL_DS,
        $24::VARCHAR(250) AS S2_VHCL_DLVRD_DS,
        $25::VARCHAR(250) AS S3_SVC_TYP_DS,
        $26::FLOAT AS NPS1_RCMDTN_NB,
        $27::FLOAT AS NPS2_RTG_RSN_NB,
        $28::VARCHAR(250) AS SI0_HOW_SVC_APNTMT_WAS_SCHDLD_DS,
        $29::FLOAT AS SI1_A_EASE_OF_SVC_APNTMT_SCHDLG_NB,
        $30::FLOAT AS SI1_B_SPD_OF_VHCL_RCPT_NB,
        $31::FLOAT AS SI1_C_OVRL_SVC_INITIATION_PRCS_RTG_NB,
        $32::VARCHAR(250) AS SA1_A_FCS_ON_YOU_AND_YOUR_NEED_DS,
        $33::VARCHAR(250) AS SA1_B_PROVIDED_USEFUL_GDNC_ABOUT_YOUR_VHCL_DS,
        $34::VARCHAR(250) AS SA1_C_KPT_YOU_INFORMED_ABOUT_YOUR_VHCL_STS_DS,
        $35::VARCHAR(250) AS SA1_D_USD_TBLT_OR_MBL_DVC_DS,
        $36::VARCHAR(250) AS SA2_SVC_ADVSR_RVW_WRK_WITH_YOU_DS,
        $37::FLOAT AS SA3_A_SVC_ADVSR_FRIENDLINESS_NB,
        $38::FLOAT AS SA3_B_SVC_ADVSR_KNWLDG_NB,
        $39::FLOAT AS SA3_C_TRST_IN_THE_ATND_STF_NB,
        $40::FLOAT AS SA3_D_OVRL_SVC_ADVSR_RTG_NB,
        $41::FLOAT AS SF1_A_EASE_OF_ACS_AND_EXT_FRM_SVC_CTR_NB,
        $42::FLOAT AS SF1_B_SVC_CTR_CLEANLINESS_NB,
        $43::FLOAT AS SF1_C_COMFORT_AND_CRTSY_NB,
        $44::FLOAT AS SF1_D_OVRL_FCLTY_RTG_NB,
        $45::VARCHAR(250) AS VD1_SOMEONE_FRM_DLR_CNTCTD_YOU_WHN_VHCL_WAS_RDY_DS,
        $46::VARCHAR(250) AS VD2_VHCL_RDY_AS_PRMSE_DS,
        $47::VARCHAR(250) AS VD3_DTL_CST_ESTMT_PROVIDED_DS,
        $48::VARCHAR(250) AS VD4_FNL_AM_PD_DS,
        $49::VARCHAR(250) AS VD5_CST_EXPLTN_AFTR_SVC_CMPLTN_DS,
        $50::VARCHAR(250) AS VD6_A_TM_RQRD_TO_CMPLT_PPRWORK_AND_PKUP_DS,
        $51::VARCHAR(250) AS VD6_B_TM_FRM_ADVSR_ARVL_TO_FNL_DLVRY_DS,
        $52::FLOAT AS VD7_A_SPD_OF_DLVRY_PRCS_NB,
        $53::FLOAT AS VD7_C_FAIRNESS_OF_CHRG_NB,
        $54::FLOAT AS VD7_B_OVRL_DLVRY_PRCS_RTG_NB,
        $55::VARCHAR(250) AS SQ1_WRK_CMPLTD_RGHT_1ST_TM_DS,
        $56::VARCHAR(250) AS SQ1A_RSN_WRK_NOT_CMPLTD_1ST_TM_DS,
        $57::VARCHAR(250) AS SQ2_RSN_WRK_NOT_CMPLTD_1ST_TM_DS,
        $58::VARCHAR(250) AS SQ2_OTHR_SPCFY_DS,
        $59::VARCHAR(250) AS SQ3_VHCL_ADJSMT_RMN_THE_SM_DS,
        $60::FLOAT AS SQ4_A_TOTL_TM_RQRD_TO_CMPLT_SVC_NB,
        $61::FLOAT AS SQ4_B_VHCL_CLEANLINESS_AND_CNDTN_AT_DLVRY_NB,
        $62::FLOAT AS SQ4_C_OVRL_SVC_QLTY_RTG_NB,
        $63::FLOAT AS SE1_OVRL_SVC_EXPRNC_NB,
        $64::VARCHAR(250) AS SE2_SVC_EXPRNC_CMNT_DS,
        $65::FLOAT AS SE3_OVRL_OPIN_OF_NSN_AS_A_BRND_NB,
        $66::FLOAT AS STSFCN_INDX_NB,
        $67::FLOAT AS SVC_INITIATION_NB,
        $68::FLOAT AS DLR_STF_NB,
        $69::FLOAT AS FCLTS_NB,
        $70::FLOAT AS DLVRY_NB,
        $71::FLOAT AS QLTY_NB,
        $72::VARCHAR(250) AS HASHKEY,
        $73::TIMESTAMP AS AUDIT_LOADED_DATE
    FROM '@NMEX_MAP_EXT_STG/validated/JDP/SERVICIO JDP 3M'
)
FILE_FORMAT = (   
TYPE = 'CSV',   
FIELD_DELIMITER = ';',   
SKIP_HEADER = 1,   
DATE_FORMAT = 'AUTO',   
TIMESTAMP_FORMAT = 'AUTO',   
NULL_IF = ('NULL', '','NaN','nan','NAN'),   
TRIM_SPACE = TRUE)ON_ERROR = 'CONTINUE';
--
select * from JDP_ASMNT_SVC_RLNG_3_MNTH_SG_PIPE;
show pipes;
 
SELECT SYSTEM$PIPE_STATUS('JDP_ASMNT_SVC_RLNG_3_MNTH_SG_PIPE');
ALTER PIPE JDP_ASMNT_SVC_RLNG_3_MNTH_SG_PIPE REFRESH;
SELECT * FROM TABLE (INFORMATION_SCHEMA.COPY_HISTORY('JDP_ASMNT_SVC_RLNG_3_MNTH_SG', START_TIME => DATEADD(hours,-30,CURRENT_TIMESTAMP())));
 