-- Create the Snowpipe for VOC_ASMNT_SVC_LST_MNTH_SG table
CREATE OR REPLACE PIPE VOC_ASMNT_SVC_LST_MNTH_SG_PIPE
AUTO_INGEST = TRUE
AS
COPY INTO VOC_ASMNT_SVC_LST_MNTH_SG
(   
    FSCL_YR_NB,
    FSCL_MNTH_NB,
    MTRX_CD,
    DLR_CD,
    DLR_NM,
    DLR_GRP_NM,
    DLR_ZN_NM,
    FOM_NM,
    ROM_NM,
    TOTL_RCVD_RCRD_NB,
    NO_CNTCT_NB,
    YES_CNTCT_NB,
    CLN_RCRD_ERR_NB,
    BNCE_NB,
    SUCCESSFULLY_SNT,
    SCSS_SNT_NB,
    SNT_WHATSAPP_NB,
    SNT_EML_NB,
    SRVY_CMPLTD_WHATSAPP_NB,
    SRVY_CMPLTD_EML_NB,
    RSPNS_RT_TOTL_RCRD_PC,
    RSPNS_RT_SCSS_SNT_PC,
    CBD_PC,
    DLR_RNKG_NB,
    SCOR_0_VOC1_SVC_EXPRNC_STSFCN_NB,
    SCOR_1_VOC1_SVC_EXPRNC_STSFCN_NB,
    SCOR_2_VOC1_SVC_EXPRNC_STSFCN_NB,
    SCOR_3_VOC1_SVC_EXPRNC_STSFCN_NB,
    SCOR_4_VOC1_SVC_EXPRNC_STSFCN_NB,
    SCOR_5_VOC1_SVC_EXPRNC_STSFCN_NB,
    SCOR_6_VOC1_SVC_EXPRNC_STSFCN_NB,
    SCOR_7_VOC1_SVC_EXPRNC_STSFCN_NB,
    SCOR_8_VOC1_SVC_EXPRNC_STSFCN_NB,
    SCOR_9_VOC1_SVC_EXPRNC_STSFCN_NB,
    SCOR_10_VOC1_SVC_EXPRNC_STSFCN_NB,
    DETRACTOR_0_6_VOC1_SVC_EXPRNC_STSFCN_NB,
    NEUTRAL_7_8_VOC1_SVC_EXPRNC_STSFCN_NB,
    PROMOTER_9_10_VOC1_SVC_EXPRNC_STSFCN_NB,
    TOTL_VOC1_SVC_EXPRNC_STSFCN_NB,
    SVC_EXPRNC_STSFCN_NPS_PC,
    YES_SQ1_WRK_CMPLTD_RGHT_1ST_TM_NB,
    NO_SQ1_WRK_CMPLTD_RGHT_1ST_TM_NB,
    TOTL_SQ1_WRK_CMPLTD_RGHT_1ST_TM_NB,
    SCOR_0_NPS1_RCMDTN_NB,
    SCOR_1_NPS1_RCMDTN_NB,
    SCOR_2_NPS1_RCMDTN_NB,
    SCOR_3_NPS1_RCMDTN_NB,
    SCOR_4_NPS1_RCMDTN_NB,
    SCOR_5_NPS1_RCMDTN_NB,
    SCOR_6_NPS1_RCMDTN_NB,
    SCOR_7_NPS1_RCMDTN_NB,
    SCOR_8_NPS1_RCMDTN_NB,
    SCOR_9_NPS1_RCMDTN_NB,
    SCOR_10_NPS1_RCMDTN_NB,
    DETRACTOR_0_6_NPS1_RCMDTN_NB,
    NEUTRAL_7_8_NPS1_RCMDTN_NB,
    PROMOTER_9_10_NPS1_RCMDTN_NB,
    TOTL_NPS1_RCMDTN_NB,
    RCMDTN_NPS_PC,
    YES_VOC2_RTRN_FOR_NXT_SVC_IN_DLR_NB,
    NO_VOC2_RTRN_FOR_NXT_SVC_IN_DLR_NB,
    TOTL_VOC2_RTRN_FOR_NXT_SVC_IN_DLR_NB,
    SCOR_0_VOC3_SVC_EXPRNC_EXPCTD_NB,
    SCOR_1_VOC3_SVC_EXPRNC_EXPCTD_NB,
    SCOR_2_VOC3_SVC_EXPRNC_EXPCTD_NB,
    SCOR_3_VOC3_SVC_EXPRNC_EXPCTD_NB,
    SCOR_4_VOC3_SVC_EXPRNC_EXPCTD_NB,
    SCOR_5_VOC3_SVC_EXPRNC_EXPCTD_NB,
    SCOR_6_VOC3_SVC_EXPRNC_EXPCTD_NB,
    SCOR_7_VOC3_SVC_EXPRNC_EXPCTD_NB,
    SCOR_8_VOC3_SVC_EXPRNC_EXPCTD_NB,
    SCOR_9_VOC3_SVC_EXPRNC_EXPCTD_NB,
    SCOR_10_VOC3_SVC_EXPRNC_EXPCTD_NB,
    DETRACTOR_0_6_VOC3_SVC_EXPRNC_EXPCTD_NB,
    NEUTRAL_7_8_VOC3_SVC_EXPRNC_EXPCTD_NB,
    PROMOTER_9_10_VOC3_SVC_EXPRNC_EXPCTD_NB,
    TOTL_VOC3_SVC_EXPRNC_EXPCTD_NB,
    EXPCTD_SVC_PRCS_NPS_PC,
    LVL_1_CLSD_ALERTS_NB,
    LVL_2_CLSD_ALERTS_NB,
    LVL_3_CLSD_ALERTS_NB,
    TOTL_CLSD_ALERTS_NB,
    LVL_1_PC_CLSD_TCKT_PC,
    OPN_TCKT_NB,
    NPS_3RM_CFCNT_SVC_EXPRNC_STSFCN_PC,
    DETRACTOR_0_6_3RM_CFCNT_SVC_EXPRNC_STSFCN_NB,
    NEUTRAL_7_8_3RM_CFCNT_SVC_EXPRNC_STSFCN_NB,
    PROMOTER_9_10_3RM_CFCNT_SVC_EXPRNC_STSFCN_NB,
    NPS_6RM_CFCNT_SVC_EXPRNC_STSFCN_PC,
    DETRACTOR_0_6_6RM_CFCNT_SVC_EXPRNC_STSFCN_NB,
    NEUTRAL_7_8_6RM_CFCNT_SVC_EXPRNC_STSFCN_NB,
    PROMOTER_9_10_6RM_CFCNT_SVC_EXPRNC_STSFCN_NB,
    CFCNT_3RM_CFCNT_SVC_EXPRNC_STSFCN_PC,
    CFCNT_6RM_CFCNT_SVC_EXPRNC_STSFCN_PC,
    HASHKEY,
    AUDIT_LOADED_DATE)
FROM (   
    SELECT
        1::FLOAT AS FSCL_YR_NB,
        2::FLOAT AS FSCL_MNTH_NB,
        3::VARCHAR(250) AS MTRX_CD,
        4::VARCHAR(250) AS DLR_CD,
        5::VARCHAR(250) AS DLR_NM,
        6::VARCHAR(250) AS DLR_GRP_NM,
        7::VARCHAR(250) AS DLR_ZN_NM,
        8::VARCHAR(250) AS FOM_NM,
        9::VARCHAR(250) AS ROM_NM,
        10::FLOAT AS TOTL_RCVD_RCRD_NB,
        11::FLOAT AS NO_CNTCT_NB,
        12::FLOAT AS YES_CNTCT_NB,
        13::FLOAT AS CLN_RCRD_ERR_NB,
        14::FLOAT AS BNCE_NB,
        15::FLOAT AS SUCCESSFULLY_SNT,
        16::FLOAT AS SCSS_SNT_NB,
        17::FLOAT AS SNT_WHATSAPP_NB,
        18::FLOAT AS SNT_EML_NB,
        19::FLOAT AS SRVY_CMPLTD_WHATSAPP_NB,
        20::FLOAT AS SRVY_CMPLTD_EML_NB,
        21::FLOAT AS RSPNS_RT_TOTL_RCRD_PC,
        22::FLOAT AS RSPNS_RT_SCSS_SNT_PC,
        23::FLOAT AS CBD_PC,
        24::FLOAT AS DLR_RNKG_NB,
        25::FLOAT AS SCOR_0_VOC1_SVC_EXPRNC_STSFCN_NB,
        26::FLOAT AS SCOR_1_VOC1_SVC_EXPRNC_STSFCN_NB,
        27::FLOAT AS SCOR_2_VOC1_SVC_EXPRNC_STSFCN_NB,
        28::FLOAT AS SCOR_3_VOC1_SVC_EXPRNC_STSFCN_NB,
        29::FLOAT AS SCOR_4_VOC1_SVC_EXPRNC_STSFCN_NB,
        30::FLOAT AS SCOR_5_VOC1_SVC_EXPRNC_STSFCN_NB,
        31::FLOAT AS SCOR_6_VOC1_SVC_EXPRNC_STSFCN_NB,
        32::FLOAT AS SCOR_7_VOC1_SVC_EXPRNC_STSFCN_NB,
        33::FLOAT AS SCOR_8_VOC1_SVC_EXPRNC_STSFCN_NB,
        34::FLOAT AS SCOR_9_VOC1_SVC_EXPRNC_STSFCN_NB,
        35::FLOAT AS SCOR_10_VOC1_SVC_EXPRNC_STSFCN_NB,
        36::FLOAT AS DETRACTOR_0_6_VOC1_SVC_EXPRNC_STSFCN_NB,
        37::FLOAT AS NEUTRAL_7_8_VOC1_SVC_EXPRNC_STSFCN_NB,
        38::FLOAT AS PROMOTER_9_10_VOC1_SVC_EXPRNC_STSFCN_NB,
        39::FLOAT AS TOTL_VOC1_SVC_EXPRNC_STSFCN_NB,
        40::FLOAT AS SVC_EXPRNC_STSFCN_NPS_PC,
        41::FLOAT AS YES_SQ1_WRK_CMPLTD_RGHT_1ST_TM_NB,
        42::FLOAT AS NO_SQ1_WRK_CMPLTD_RGHT_1ST_TM_NB,
        43::FLOAT AS TOTL_SQ1_WRK_CMPLTD_RGHT_1ST_TM_NB,
        44::FLOAT AS SCOR_0_NPS1_RCMDTN_NB,
        45::FLOAT AS SCOR_1_NPS1_RCMDTN_NB,
        46::FLOAT AS SCOR_2_NPS1_RCMDTN_NB,
        47::FLOAT AS SCOR_3_NPS1_RCMDTN_NB,
        48::FLOAT AS SCOR_4_NPS1_RCMDTN_NB,
        49::FLOAT AS SCOR_5_NPS1_RCMDTN_NB,
        50::FLOAT AS SCOR_6_NPS1_RCMDTN_NB,
        51::FLOAT AS SCOR_7_NPS1_RCMDTN_NB,
        52::FLOAT AS SCOR_8_NPS1_RCMDTN_NB,
        53::FLOAT AS SCOR_9_NPS1_RCMDTN_NB,
        54::FLOAT AS SCOR_10_NPS1_RCMDTN_NB,
        55::FLOAT AS DETRACTOR_0_6_NPS1_RCMDTN_NB,
        56::FLOAT AS NEUTRAL_7_8_NPS1_RCMDTN_NB,
        57::FLOAT AS PROMOTER_9_10_NPS1_RCMDTN_NB,
        58::FLOAT AS TOTL_NPS1_RCMDTN_NB,
        59::FLOAT AS RCMDTN_NPS_PC,
        60::FLOAT AS YES_VOC2_RTRN_FOR_NXT_SVC_IN_DLR_NB,
        61::FLOAT AS NO_VOC2_RTRN_FOR_NXT_SVC_IN_DLR_NB,
        62::FLOAT AS TOTL_VOC2_RTRN_FOR_NXT_SVC_IN_DLR_NB,
        63::FLOAT AS SCOR_0_VOC3_SVC_EXPRNC_EXPCTD_NB,
        64::FLOAT AS SCOR_1_VOC3_SVC_EXPRNC_EXPCTD_NB,
        65::FLOAT AS SCOR_2_VOC3_SVC_EXPRNC_EXPCTD_NB,
        66::FLOAT AS SCOR_3_VOC3_SVC_EXPRNC_EXPCTD_NB,
        67::FLOAT AS SCOR_4_VOC3_SVC_EXPRNC_EXPCTD_NB,
        68::FLOAT AS SCOR_5_VOC3_SVC_EXPRNC_EXPCTD_NB,
        69::FLOAT AS SCOR_6_VOC3_SVC_EXPRNC_EXPCTD_NB,
        70::FLOAT AS SCOR_7_VOC3_SVC_EXPRNC_EXPCTD_NB,
        71::FLOAT AS SCOR_8_VOC3_SVC_EXPRNC_EXPCTD_NB,
        72::FLOAT AS SCOR_9_VOC3_SVC_EXPRNC_EXPCTD_NB,
        73::FLOAT AS SCOR_10_VOC3_SVC_EXPRNC_EXPCTD_NB,
        74::FLOAT AS DETRACTOR_0_6_VOC3_SVC_EXPRNC_EXPCTD_NB,
        75::FLOAT AS NEUTRAL_7_8_VOC3_SVC_EXPRNC_EXPCTD_NB,
        76::FLOAT AS PROMOTER_9_10_VOC3_SVC_EXPRNC_EXPCTD_NB,
        77::FLOAT AS TOTL_VOC3_SVC_EXPRNC_EXPCTD_NB,
        78::FLOAT AS EXPCTD_SVC_PRCS_NPS_PC,
        79::FLOAT AS LVL_1_CLSD_ALERTS_NB,
        80::FLOAT AS LVL_2_CLSD_ALERTS_NB,
        81::FLOAT AS LVL_3_CLSD_ALERTS_NB,
        82::FLOAT AS TOTL_CLSD_ALERTS_NB,
        83::FLOAT AS LVL_1_PC_CLSD_TCKT_PC,
        84::FLOAT AS OPN_TCKT_NB,
        85::FLOAT AS NPS_3RM_CFCNT_SVC_EXPRNC_STSFCN_PC,
        86::FLOAT AS DETRACTOR_0_6_3RM_CFCNT_SVC_EXPRNC_STSFCN_NB,
        87::FLOAT AS NEUTRAL_7_8_3RM_CFCNT_SVC_EXPRNC_STSFCN_NB,
        88::FLOAT AS PROMOTER_9_10_3RM_CFCNT_SVC_EXPRNC_STSFCN_NB,
        89::FLOAT AS NPS_6RM_CFCNT_SVC_EXPRNC_STSFCN_PC,
        90::FLOAT AS DETRACTOR_0_6_6RM_CFCNT_SVC_EXPRNC_STSFCN_NB,
        91::FLOAT AS NEUTRAL_7_8_6RM_CFCNT_SVC_EXPRNC_STSFCN_NB,
        92::FLOAT AS PROMOTER_9_10_6RM_CFCNT_SVC_EXPRNC_STSFCN_NB,
        93::FLOAT AS CFCNT_3RM_CFCNT_SVC_EXPRNC_STSFCN_PC,
        94::FLOAT AS CFCNT_6RM_CFCNT_SVC_EXPRNC_STSFCN_PC,
        95::VARCHAR(250) AS HASHKEY,
        96::TIMESTAMP AS AUDIT_LOADED_DATE
    FROM '@NMEX_MAP_EXT_STG/validated/JDP/SERVICIO VOC 1M'
)
FILE_FORMAT = (   
TYPE = 'CSV',   
FIELD_DELIMITER = ';',   
SKIP_HEADER = 1,   
DATE_FORMAT = 'AUTO',   
TIMESTAMP_FORMAT = 'AUTO',   
NULL_IF = ('NULL', '','NaN','nan','NAN'),   
TRIM_SPACE = TRUE)ON_ERROR = 'CONTINUE';
--
select * from VOC_ASMNT_SVC_LST_MNTH_SG_PIPE;
show pipes;
 
SELECT SYSTEM$PIPE_STATUS('VOC_ASMNT_SVC_LST_MNTH_SG_PIPE');
ALTER PIPE VOC_ASMNT_SVC_LST_MNTH_SG_PIPE REFRESH;
SELECT * FROM TABLE (INFORMATION_SCHEMA.COPY_HISTORY('VOC_ASMNT_SVC_LST_MNTH_SG', START_TIME => DATEADD(hours,-30,CURRENT_TIMESTAMP())));
 